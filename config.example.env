# Telegram API 配置
# 请前往 https://my.telegram.org/apps 获取 API ID 和 API Hash
TG_API_ID=12345678
TG_API_HASH=your_api_hash_here

# 多源聊天文件（每行一个，可含 # 注释）
TG_SOURCE_FILE=sources.txt
TG_TARGET=@target_channel

# 运行模式: live 或 past (默认 live)
TG_MODE=past

# 文件转发开关 (true/false)
TG_ENABLE_FILE_FORWARD=true

# 相册聚合最大条数（达到后立即发送）
TG_ALBUM_MAX_ITEMS=10
# 相册补漏最大ID跨度（用于回补缺失相册项）
TG_ALBUM_BACKFILL_MAX_RANGE=20

# 媒体大小阈值（MB），超过此大小的媒体将被跳过
# 默认 100MB，约等于 2-3 个短视频
# 如需调整建议值：
# - 50：1-2 个短视频
# - 100：2-3 个短视频（默认）
# - 200：4-6 个短视频
# - 500：10-15 个短视频
# 0 表示不限制大小
TG_MEDIA_SIZE_LIMIT=0

# 文档媒体兜底允许的文件后缀（逗号分隔，不带点也可）
# 仅在 MIME/属性无法识别时生效
# 仅包含 Telegram 频道可直接预览的格式：
# - 图片：jpg, jpeg, png, webp, gif, bmp, heic, tiff, svg
# - 视频：mp4, mov, webm, m4v, mkv
TG_MEDIA_EXT_ALLOWLIST=jpg,jpeg,png,webp,gif,bmp,heic,tiff,tif,svg,mp4,mov,webm,m4v,mkv

# 相册文本合并窗口（秒），用于把相册前的短文本合并为相册说明
TG_TEXT_MERGE_WINDOW=2.0
# 待合并文本最小长度（字符），避免短词误合并
TG_TEXT_MERGE_MIN_LEN=8
# 合并文本与相册的最大消息ID间隔
TG_TEXT_MERGE_MAX_ID_GAP=8

# Past 模式配置（单页拉取数量，控制分页大小；首轮用于回补窗口，单次请求上限 100）
TG_PAST_LIMIT=5

# 轮询/补漏间隔（秒）：past 模式轮询频率，live 模式补漏周期
TG_CATCH_UP_INTERVAL=60

# 相册延迟（秒），建议 5.0 或更高以应对复杂媒体组，防止消息截断
TG_ALBUM_DELAY=30

# 转发间隔（秒），每条消息之间的延迟，避免触发 FloodWait
# 建议值：普通频道 0.5-1.0，高风险频道 2.0-5.0
TG_FORWARD_DELAY=10.0

# FloodWait 重试策略
# 最大重试次数
TG_FLOOD_WAIT_MAX_RETRIES=5
# 最大累计等待时间（秒）
TG_FLOOD_WAIT_MAX_TOTAL_WAIT=3600
# 请求超时（秒），用于发送与历史拉取
TG_REQUEST_TIMEOUT=120
# 等待发送任务完成的超时时间（秒，超时会触发重连）
TG_DISPATCHER_IDLE_TIMEOUT=300
# 更新流空闲超时（秒，0 表示禁用，超时会触发重连）
TG_UPDATES_IDLE_TIMEOUT=600

# 队列处理 Worker 数量（默认 5），控制并发转发任务数
# 增大此值可避免大文件/相册导致消息堆积，但也可能增加 FloodWait 风险
TG_WORKER_COUNT=2

# 日志保留行数（默认 100）
TG_LOG_MAX_LINES=500

# 关键词过滤
# 仅白名单有值时：只转发包含任一白名单关键词的消息
# 黑名单有值时：包含黑名单关键词的消息不转发
# 关键词是否区分大小写（true/false）
TG_KEYWORD_CASE_SENSITIVE=false
# 关键词文件路径（可选，支持热更新）
TG_KEYWORD_FILE=keywords.txt

# 去重记录文件路径（默认 deduplication.json，路径相对项目根）
TG_DEDUP_FILE=deduplication.json

# 状态/去重落盘与日志截断间隔（秒）
TG_STATE_FLUSH_INTERVAL=60
# 退出/热重启等待任务完成的超时提示阈值（秒，超时告警；退出信号下仍可能强制退出）
TG_SHUTDOWN_DRAIN_TIMEOUT=3
# 状态缺口超时（秒），超过后允许跳过缺失ID
TG_STATE_GAP_TIMEOUT=300
# 状态待确认ID上限（超过后会触发强制前移）
TG_STATE_PENDING_LIMIT=2000

# 热更新检查间隔（秒）
TG_HOTRELOAD_INTERVAL=2

# 去重阈值
TG_DEDUP_SIMHASH_THRESHOLD=3
TG_DEDUP_JACCARD_SHORT_THRESHOLD=0.7
TG_DEDUP_JACCARD_LONG_THRESHOLD=0.5
TG_DEDUP_RECENT_TEXT_LIMIT=50
#
# 缩略图去重
# 缩略图临时存放目录（默认 data，路径相对项目根）
TG_THUMB_DIR=data
# pHash / dHash 哈明距离阈值
TG_DEDUP_PHASH_THRESHOLD=10
TG_DEDUP_DHASH_THRESHOLD=10
# 多图片去重比例阈值（0.0-1.0，默认0.34，即超过1/3的图片匹配才算重复）
# 单张图片时任何匹配都算重复，多张图片时只有匹配比例超过此值才算重复
TG_DEDUP_ALBUM_THUMB_RATIO=0.34
# 短文本阈值（字符数，默认50）
# 用于有媒体+短文本场景的双重验证：
# - 当消息包含图片/视频，且文本字符数 ≤ 此阈值时
# - 必须文本相似 AND 媒体重复，才判定为重复
# - 适用场景：单图+"好看"、3图相册+"😂"、视频+"哈哈" 等
# - 避免相同评论+不同图片被误判为重复
# - 其他场景（纯文本、长文本+媒体）：文本相似即判定重复
TG_DEDUP_SHORT_TEXT_THRESHOLD=20

# 文本替换规则文件路径 (JSON 格式)
TG_REPLACEMENT_FILE=replacements.json

# 内容追加配置文件路径 (JSON 格式，包含 header 和 footer)
TG_CONTENT_ADDITION_FILE=content_addition.json

# 文本/媒体长度限制（UTF-16 长度）
TG_APPEND_LIMIT_WITH_MEDIA=1024
TG_APPEND_LIMIT_TEXT=4096

# 日志级别: DEBUG, INFO, WARNING, ERROR
TG_LOG_LEVEL=INFO

# Session 文件名
TG_SESSION_NAME=user_session

# 去重记录保留条数（默认 5000）
TG_DEDUP_LIMIT=20000
# 媒体元数据签名去重窗口（默认 15000，建议 10000-20000）
TG_MEDIA_DEDUP_LIMIT=50000
